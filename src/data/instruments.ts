import { Instrument } from "./types";
import { realWorldData } from "./realWorldData";

const rawInstruments: Instrument[] = [
  // ============================================
  // CATEGORY A: GRANT-BASED INSTRUMENTS
  // ============================================
  {
    id: "pure-grant",
    slug: "pure-grant",
    name: "Pure Grant",
    shortName: "Grant",
    category: "grant",
    number: 1,
    tagline: "Non-repayable funding for impact",
    description:
      "Outright funding with no expectation of financial return. Deployed to catalyze early-stage innovation, build organizational capacity, or fund activities too risky for any form of repayable capital.",
    sources: [
      { name: "Foundations", type: "source", description: "Philanthropic foundations deploying endowment capital for mission", examples: ["MacArthur Foundation", "Ford Foundation", "Bloomberg Philanthropies"] },
      { name: "Government Agencies", type: "source", description: "Federal and state agencies funding R&D and demonstration", examples: ["DOE", "OCED", "ARPA-E", "NSF"] },
      { name: "Corporate CSR", type: "source", description: "Corporate social responsibility and sustainability programs", examples: ["Google.org", "Microsoft Climate Innovation Fund"] },
    ],
    typicalSize: "$50K - $10M",
    motivationMix: { impact: 90, financial: 0, policy: 10 },
    financialReturn: { min: -100, expected: -100, max: -100 },
    nonFinancialReturns: ["Tax deduction", "Mission alignment", "Social/environmental impact", "Knowledge generation"],
    riskLevel: "very-low",
    actors: [
      { name: "Grant Administrator", type: "enabler", description: "Manages disbursement, reporting, and compliance" },
      { name: "Fiscal Sponsor", type: "enabler", description: "Provides financial infrastructure for unincorporated projects" },
      { name: "Impact Evaluator", type: "ecosystem", description: "Assesses whether grant achieves intended outcomes" },
    ],
    defaultSteps: [
      { step: 1, title: "Project Underperforms", description: "Project fails to meet milestones or impact targets" },
      { step: 2, title: "No Financial Default Possible", description: "Funds are non-recoverable by design. There is no debt to default on.", lossAbsorber: "Funder (by design)" },
      { step: 3, title: "Programmatic Review", description: "Funder reviews what went wrong; future grants may be adjusted" },
    ],
    recoveryRate: "0%",
    costRange: "0%",
    calculatorParams: [
      { id: "amount", label: "Grant Amount", type: "currency", default: 500000, min: 10000, max: 50000000, step: 10000 },
    ],
    costFormula: "Cost to recipient = $0. Cost to funder = 100% of grant amount (by design).",
    features: ["non-repayable", "impact-focused", "risk-tolerant"],
    useCase: "Early-stage R&D, capacity building, proof-of-concept validation",
  },

  {
    id: "recoverable-grant",
    slug: "recoverable-grant",
    name: "Recoverable Grant",
    shortName: "Recoverable Grant",
    category: "grant",
    number: 2,
    tagline: "Repaid if successful, forgiven if not",
    description:
      "A grant that becomes repayable if the funded project succeeds. If the project fails, the grant converts to a non-repayable gift. This creates a 'heads-I-get-repaid, tails-it's-a-grant' structure that recycles capital while protecting early-stage ventures.",
    sources: [
      { name: "Foundations (via PRIs)", type: "source", description: "Foundations deploying program-related investments", examples: ["Omidyar Network", "Kresge Foundation"] },
      { name: "DFIs", type: "source", description: "Development finance institutions with flexible mandates", examples: ["IFC", "CDC Group"] },
      { name: "Impact-First Philanthropies", type: "source", description: "Mission-driven funders willing to accept 0% return" },
    ],
    typicalSize: "$100K - $5M",
    motivationMix: { impact: 80, financial: 10, policy: 10 },
    financialReturn: { min: -100, expected: -50, max: 0 },
    nonFinancialReturns: ["Capital recycling on success", "Mission alignment", "Portfolio learnings"],
    riskLevel: "low",
    actors: [
      { name: "Success-Metric Verifier", type: "enabler", description: "Determines whether success conditions are met, triggering repayment" },
      { name: "Impact Auditor", type: "ecosystem", description: "Evaluates overall impact regardless of financial outcome" },
    ],
    defaultSteps: [
      { step: 1, title: "Project Fails to Meet Success Criteria", description: "Agreed-upon milestones not achieved within timeframe" },
      { step: 2, title: "Grant Converts to Non-Repayable", description: "Funder absorbs the full loss. No recourse against recipient.", lossAbsorber: "Funder" },
      { step: 3, title: "Learnings Captured", description: "Failed project generates knowledge that informs future deployments" },
    ],
    recoveryRate: "0% on failure, 100% on success",
    costRange: "0%",
    calculatorParams: [
      { id: "amount", label: "Grant Amount", type: "currency", default: 1000000, min: 50000, max: 10000000, step: 50000 },
      { id: "successProb", label: "Probability of Success", type: "percentage", default: 40, min: 5, max: 95, step: 5 },
    ],
    costFormula: "Expected cost to funder = Amount x (1 - Success Probability). Cost to recipient = $0.",
    features: ["risk-tolerant", "flexible", "impact-focused"],
    useCase: "Pilot projects, first-of-a-kind ventures, social enterprises in early revenue stage",
  },

  {
    id: "forgivable-loan",
    slug: "forgivable-loan",
    name: "Forgivable Loan",
    shortName: "Forgivable Loan",
    category: "grant",
    number: 3,
    tagline: "Meet the conditions, lose the debt",
    description:
      "A loan that is forgiven if the borrower meets specified conditions (e.g., job creation targets, operating in an underserved area, achieving climate metrics). If conditions aren't met, standard repayment kicks in.",
    sources: [
      { name: "Government Programs", type: "source", description: "Federal, state, and local economic development programs", examples: ["SBA", "CDFI Fund", "State green banks"] },
      { name: "Foundations", type: "source", description: "Foundations using loans as a flexible deployment tool" },
      { name: "DFIs", type: "source", description: "Development finance institutions with policy mandates" },
    ],
    typicalSize: "$100K - $20M",
    motivationMix: { impact: 50, financial: 10, policy: 40 },
    financialReturn: { min: -100, expected: -60, max: 5 },
    nonFinancialReturns: ["Policy goal achievement", "Job creation", "Community development"],
    riskLevel: "low",
    actors: [
      { name: "Compliance Monitor", type: "enabler", description: "Tracks whether forgiveness conditions are being met" },
      { name: "Government Certifying Agency", type: "ecosystem", description: "Officially certifies compliance to trigger forgiveness" },
    ],
    defaultSteps: [
      { step: 1, title: "Conditions Assessment", description: "Borrower either meets or fails to meet forgiveness conditions" },
      { step: 2, title: "Path A: Conditions Met", description: "Loan is fully forgiven. No repayment required.", lossAbsorber: "Funder (by design)" },
      { step: 3, title: "Path B: Conditions Not Met", description: "Reverts to standard loan. Missing payments triggers normal debt default process." },
      { step: 4, title: "Standard Collection (Path B only)", description: "Lender pursues collateral, restructuring, or legal remedies", lossAbsorber: "Borrower" },
    ],
    recoveryRate: "60-90% (when conditions not met)",
    costRange: "0-2%",
    calculatorParams: [
      { id: "amount", label: "Loan Amount", type: "currency", default: 2000000, min: 50000, max: 50000000, step: 50000 },
      { id: "rate", label: "Interest Rate (if not forgiven)", type: "percentage", default: 3, min: 0, max: 10, step: 0.25 },
      { id: "term", label: "Compliance Period (years)", type: "years", default: 5, min: 1, max: 15, step: 1 },
      { id: "forgivenessProb", label: "Forgiveness Probability", type: "percentage", default: 70, min: 10, max: 95, step: 5 },
    ],
    costFormula: "Expected cost = Rate x (1 - Forgiveness Probability). If forgiveness = 70%, effective cost = Rate x 30%.",
    features: ["flexible", "concessionary", "policy-driven"],
    useCase: "Community development, green building retrofits, workforce development in underserved areas",
  },

  // ============================================
  // CATEGORY B: DEBT INSTRUMENTS
  // ============================================
  {
    id: "concessionary-debt",
    slug: "concessionary-debt",
    name: "Below-Market / Concessionary Debt",
    shortName: "Concessionary Debt",
    category: "debt",
    number: 4,
    tagline: "Cheaper loans to make impact viable",
    description:
      "Loans offered at interest rates below what the market would demand, reducing the cost of capital for impact enterprises. The rate concession bridges the gap between what a project can afford and what commercial lenders require.",
    sources: [
      { name: "DFIs", type: "source", description: "Development finance institutions with concessionary mandates", examples: ["IFC", "DFC (OPIC)", "EBRD"] },
      { name: "Foundations (PRIs)", type: "source", description: "Foundation endowments deployed as program-related investments" },
      { name: "CDFIs", type: "source", description: "Community Development Financial Institutions focused on underserved areas", examples: ["Opportunity Finance Network members"] },
      { name: "Impact Lenders", type: "source", description: "Mission-driven lenders accepting below-market returns" },
    ],
    typicalSize: "$500K - $50M",
    motivationMix: { impact: 60, financial: 25, policy: 15 },
    financialReturn: { min: -20, expected: 3, max: 5 },
    nonFinancialReturns: ["Impact outcomes", "Portfolio diversification", "Mission-aligned deployment"],
    riskLevel: "moderate",
    actors: [
      { name: "Senior Lenders", type: "counterparty", description: "Commercial lenders benefiting from de-risked capital structure" },
      { name: "Loan Servicer", type: "enabler", description: "Manages payment collection and borrower communication" },
      { name: "Credit Analyst", type: "enabler", description: "Underwrites the loan and assesses borrower capacity" },
    ],
    defaultSteps: [
      { step: 1, title: "Missed Payment", description: "Borrower fails to make a scheduled interest or principal payment" },
      { step: 2, title: "Cure Period", description: "Borrower has 30-60 days to cure the default" },
      { step: 3, title: "Subordination Activates", description: "Concessionary debt is often subordinated — absorbs losses before senior lenders", lossAbsorber: "Concessionary lender (first loss)" },
      { step: 4, title: "Collateral Enforcement", description: "Lender claims collateral or project assets" },
    ],
    recoveryRate: "30-60%",
    costRange: "2-5%",
    calculatorParams: [
      { id: "amount", label: "Loan Amount", type: "currency", default: 5000000, min: 100000, max: 100000000, step: 100000 },
      { id: "rate", label: "Interest Rate", type: "percentage", default: 3.5, min: 0.5, max: 8, step: 0.25 },
      { id: "term", label: "Loan Term (years)", type: "years", default: 7, min: 1, max: 20, step: 1 },
      { id: "marketRate", label: "Comparable Market Rate", type: "percentage", default: 9, min: 4, max: 15, step: 0.5 },
    ],
    costFormula: "Annual cost = Principal x Rate. Concession value = Principal x (Market Rate - Concessionary Rate) x Term.",
    features: ["concessionary", "patient", "risk-tolerant"],
    useCase: "Affordable housing, clean energy projects, SME lending in emerging markets",
  },

  {
    id: "first-loss-debt",
    slug: "first-loss-debt",
    name: "First-Loss / Subordinated Debt",
    shortName: "First-Loss Debt",
    category: "debt",
    number: 5,
    tagline: "I lose first, so you don't have to",
    description:
      "Debt that contractually absorbs the first losses in a portfolio or project, protecting senior lenders. This is often the single most important piece in a blended finance structure — a thin layer of risk absorption that unlocks multiples of commercial capital.",
    sources: [
      { name: "Foundations", type: "source", description: "Philanthropic capital deployed to de-risk commercial investment" },
      { name: "DFIs", type: "source", description: "Development agencies providing catalytic first-loss positions" },
      { name: "Anchor Impact Investors", type: "source", description: "Mission-driven investors willing to take subordinated positions" },
    ],
    typicalSize: "$1M - $50M (enabling 5-10x in senior debt)",
    motivationMix: { impact: 70, financial: 15, policy: 15 },
    financialReturn: { min: -100, expected: 2, max: 6 },
    nonFinancialReturns: ["Massive leverage (1:5 to 1:10 mobilization)", "Market creation", "Proof of concept for asset class"],
    riskLevel: "high",
    actors: [
      { name: "Senior Debt Holders", type: "counterparty", description: "Commercial banks and institutional investors protected by the first-loss layer", examples: ["Commercial banks", "Pension funds", "Insurance companies"] },
      { name: "Fund Manager", type: "enabler", description: "Structures the waterfall and manages the portfolio" },
      { name: "Rating Agency", type: "ecosystem", description: "May rate senior tranche higher due to first-loss protection" },
    ],
    defaultSteps: [
      { step: 1, title: "Portfolio Losses Occur", description: "Defaults within the portfolio generate losses" },
      { step: 2, title: "First-Loss Tranche Absorbs", description: "Losses are allocated to first-loss debt until this tranche is fully depleted", lossAbsorber: "First-loss / catalytic investors" },
      { step: 3, title: "Mezzanine Tranche Hit", description: "If losses exceed first-loss capacity, mezzanine tranche begins absorbing", lossAbsorber: "Mezzanine investors" },
      { step: 4, title: "Senior Tranche Impaired", description: "Only after first-loss AND mezzanine are wiped out does senior debt take losses", lossAbsorber: "Senior investors (last resort)" },
    ],
    recoveryRate: "0-30% (for first-loss holders)",
    costRange: "3-8%",
    calculatorParams: [
      { id: "totalFund", label: "Total Fund Size", type: "currency", default: 50000000, min: 5000000, max: 500000000, step: 5000000 },
      { id: "firstLossPct", label: "First-Loss Tranche (%)", type: "percentage", default: 15, min: 5, max: 30, step: 1 },
      { id: "expectedLoss", label: "Expected Portfolio Loss Rate", type: "percentage", default: 8, min: 1, max: 25, step: 1 },
      { id: "seniorRate", label: "Senior Debt Rate", type: "percentage", default: 5, min: 2, max: 10, step: 0.5 },
    ],
    costFormula: "First-loss cost = Expected losses absorbed / First-loss tranche size. Leverage = Total fund / First-loss amount.",
    features: ["risk-tolerant", "concessionary", "high-leverage"],
    useCase: "Blended finance vehicles, emerging market lending, FOAK project finance",
  },

  {
    id: "pri",
    slug: "program-related-investment",
    name: "Program-Related Investment (PRI)",
    shortName: "PRI",
    category: "debt",
    number: 6,
    tagline: "Foundation capital with a mission mandate",
    description:
      "Investments made by private foundations where the primary purpose is charitable, not financial return. PRIs count toward the 5% annual minimum distribution requirement, making them a powerful tool for foundations to deploy more capital for impact while preserving endowment.",
    sources: [
      { name: "Private Foundations", type: "source", description: "US foundations deploying PRIs as part of 5% minimum distribution", examples: ["Gates Foundation", "MacArthur Foundation", "Heron Foundation"] },
    ],
    typicalSize: "$250K - $15M",
    motivationMix: { impact: 85, financial: 5, policy: 10 },
    financialReturn: { min: -100, expected: 1, max: 3 },
    nonFinancialReturns: ["Counts toward 5% distribution", "Mission alignment", "Capital recycling", "Regulatory compliance"],
    riskLevel: "moderate",
    actors: [
      { name: "IRS", type: "ecosystem", description: "Regulates PRI eligibility — primary purpose must be charitable" },
      { name: "Foundation Investment Committee", type: "enabler", description: "Approves PRI investments and monitors portfolio" },
      { name: "Legal Counsel", type: "enabler", description: "Ensures PRI compliance with IRS regulations" },
    ],
    defaultSteps: [
      { step: 1, title: "Borrower Struggles to Repay", description: "Social enterprise or nonprofit faces financial difficulty" },
      { step: 2, title: "Foundation Absorbs Loss", description: "PRI regulations require charitable purpose as primary motivation — loss tolerance is built in", lossAbsorber: "Foundation" },
      { step: 3, title: "IRS Compliance Check", description: "Foundation must demonstrate the PRI was made for charitable purposes, not financial return" },
    ],
    recoveryRate: "40-70%",
    costRange: "0-3%",
    calculatorParams: [
      { id: "amount", label: "PRI Amount", type: "currency", default: 2000000, min: 100000, max: 25000000, step: 100000 },
      { id: "rate", label: "Interest Rate", type: "percentage", default: 1.5, min: 0, max: 5, step: 0.25 },
      { id: "term", label: "Term (years)", type: "years", default: 7, min: 2, max: 15, step: 1 },
    ],
    costFormula: "Annual cost to borrower = Principal x Rate. Typically 0-3%, well below market.",
    features: ["concessionary", "patient", "impact-focused"],
    useCase: "Social enterprises, affordable housing, community health, education",
  },

  {
    id: "revenue-based-financing",
    slug: "revenue-based-financing",
    name: "Revenue-Based Financing (RBF)",
    shortName: "RBF",
    category: "debt",
    number: 7,
    tagline: "Pay as you earn",
    description:
      "Capital repaid as a fixed percentage of monthly or quarterly revenue, up to a predetermined cap (typically 1.5-2.5x the invested amount). Payments flex with revenue — high revenue months mean faster repayment, low months mean lower payments. No fixed schedule to 'miss.'",
    sources: [
      { name: "RBF Lenders", type: "source", description: "Specialized revenue-based financing providers", examples: ["Lighter Capital", "Clearco", "Pipe"] },
      { name: "Impact Investors", type: "source", description: "Impact funds using RBF for portfolio companies" },
      { name: "Venture Debt Funds", type: "source", description: "Funds offering non-dilutive growth capital" },
    ],
    typicalSize: "$50K - $5M",
    motivationMix: { impact: 30, financial: 65, policy: 5 },
    financialReturn: { min: -100, expected: 15, max: 35 },
    nonFinancialReturns: ["Non-dilutive", "Aligned incentives", "Portfolio revenue share"],
    riskLevel: "moderate",
    actors: [
      { name: "Offtake Partners / Customers", type: "counterparty", description: "The customers whose purchases generate the revenue stream that repays the financing" },
      { name: "Revenue Verification Service", type: "enabler", description: "Audits actual revenue to calculate correct payment amounts" },
      { name: "Payment Processor", type: "enabler", description: "May auto-deduct repayment percentage from transactions" },
    ],
    defaultSteps: [
      { step: 1, title: "Revenue Declines", description: "Company revenue drops significantly — payments automatically decrease proportionally" },
      { step: 2, title: "Extended Payback Period", description: "Lower revenue = slower repayment. No fixed deadline missed. Built-in flexibility." },
      { step: 3, title: "Total Revenue Failure", description: "If revenue drops to zero, payments drop to zero. Lender may negotiate restructuring or equity conversion.", lossAbsorber: "RBF Lender" },
      { step: 4, title: "Possible Equity Conversion", description: "Some RBF agreements allow conversion to equity in distressed scenarios" },
    ],
    recoveryRate: "20-80% (highly variable based on revenue)",
    costRange: "15-40% effective APR",
    calculatorParams: [
      { id: "amount", label: "Funding Amount", type: "currency", default: 500000, min: 25000, max: 10000000, step: 25000 },
      { id: "revShare", label: "Revenue Share (%)", type: "percentage", default: 5, min: 1, max: 15, step: 0.5 },
      { id: "cap", label: "Repayment Cap (x)", type: "multiple", default: 1.8, min: 1.2, max: 3.0, step: 0.1 },
      { id: "monthlyRev", label: "Monthly Revenue", type: "currency", default: 200000, min: 10000, max: 5000000, step: 10000 },
    ],
    costFormula: "Total repayment = Amount x Cap Multiple. Monthly payment = Revenue x Share %. Months to repay = Total / Monthly payment. Effective APR = (Cap - 1) / (Months / 12).",
    features: ["flexible", "non-dilutive", "revenue-aligned"],
    useCase: "SaaS companies, recurring-revenue businesses, climate tech with early revenue",
  },

  {
    id: "convertible-note",
    slug: "convertible-note",
    name: "Convertible Note / SAFE",
    shortName: "Convertible Note",
    category: "debt",
    number: 8,
    tagline: "Debt now, equity later",
    description:
      "Short-term debt that converts to equity at the next financing round, typically at a discount (15-25%) to the new round's price or subject to a valuation cap. Bridges the gap when a company is too early to price a round.",
    sources: [
      { name: "Angel Investors", type: "source", description: "Individual accredited investors making early bets" },
      { name: "Early-Stage VCs", type: "source", description: "Seed-stage venture funds" },
      { name: "Accelerator Funds", type: "source", description: "Accelerator programs providing initial capital", examples: ["Y Combinator (SAFE)", "Techstars"] },
    ],
    typicalSize: "$50K - $3M",
    motivationMix: { impact: 20, financial: 75, policy: 5 },
    financialReturn: { min: -100, expected: 20, max: 100 },
    nonFinancialReturns: ["Early access to high-growth companies", "Pro-rata rights", "Information rights"],
    riskLevel: "very-high",
    actors: [
      { name: "Future Equity Investors", type: "counterparty", description: "Series A/B investors whose round triggers the conversion" },
      { name: "Legal Counsel", type: "enabler", description: "Structures conversion terms, cap, and discount" },
    ],
    defaultSteps: [
      { step: 1, title: "Company Fails Before Conversion", description: "No equity round occurs; note treated as unsecured debt" },
      { step: 2, title: "Liquidation Priority", description: "Note holders have claim ahead of equity, but typically behind secured debt", lossAbsorber: "Note holders (likely total loss)" },
      { step: 3, title: "Minimal Recovery", description: "Early-stage companies rarely have assets — recovery is usually near zero" },
    ],
    recoveryRate: "0-10%",
    costRange: "0-5% interest + equity dilution",
    calculatorParams: [
      { id: "amount", label: "Note Amount", type: "currency", default: 500000, min: 25000, max: 5000000, step: 25000 },
      { id: "rate", label: "Interest Rate", type: "percentage", default: 2, min: 0, max: 8, step: 0.5 },
      { id: "discount", label: "Conversion Discount", type: "percentage", default: 20, min: 0, max: 30, step: 5 },
      { id: "cap", label: "Valuation Cap ($M)", type: "currency", default: 10000000, min: 1000000, max: 100000000, step: 1000000 },
    ],
    costFormula: "Nominal cost = Interest Rate. Effective cost = Conversion Discount (equity given up at next round). True cost depends on next-round valuation.",
    features: ["flexible", "high-risk", "equity-linked"],
    useCase: "Pre-seed and seed startups, bridge financing between rounds",
  },

  // ============================================
  // CATEGORY C: GUARANTEES & RISK MITIGATION
  // ============================================
  {
    id: "loan-guarantee",
    slug: "loan-guarantee",
    name: "Loan / Credit Guarantee",
    shortName: "Loan Guarantee",
    category: "guarantee",
    number: 9,
    tagline: "A backstop that unlocks lending",
    description:
      "A commitment by a guarantor to cover a lender's losses if the borrower defaults. The guarantor deploys no capital upfront — only if triggered. Massive leverage: a $10M guarantee can unlock $50-100M+ in commercial lending.",
    sources: [
      { name: "DFIs", type: "source", description: "Development agencies providing sovereign and project guarantees", examples: ["MIGA/World Bank", "USAID DCA"] },
      { name: "Foundations", type: "source", description: "Philanthropies using guarantee capital for leverage" },
      { name: "Government Agencies", type: "source", description: "Government backstop programs", examples: ["DOE LPO", "SBA", "USDA"] },
    ],
    typicalSize: "$1M - $500M+ (guarantee commitment)",
    motivationMix: { impact: 50, financial: 10, policy: 40 },
    financialReturn: { min: -100, expected: 1, max: 2 },
    nonFinancialReturns: ["Exceptional leverage (1:5 to 1:10+)", "Market creation", "Financial system strengthening"],
    riskLevel: "moderate",
    actors: [
      { name: "Primary Lender", type: "counterparty", description: "Commercial bank or lender protected by the guarantee — they issue the actual loan" },
      { name: "Borrower", type: "counterparty", description: "The entity receiving the loan, whose risk the guarantee absorbs" },
      { name: "Guarantee Administrator", type: "enabler", description: "Manages the guarantee facility, processes claims" },
    ],
    defaultSteps: [
      { step: 1, title: "Borrower Defaults on Loan", description: "Borrower fails to make payments to the primary lender" },
      { step: 2, title: "Lender Files Guarantee Claim", description: "Primary lender submits documentation proving default and loss" },
      { step: 3, title: "Guarantor Pays Lender", description: "Guarantor covers losses up to guarantee amount (partial or full coverage)", lossAbsorber: "Guarantor" },
      { step: 4, title: "Subrogation", description: "Guarantor may pursue recovery from borrower's assets" },
    ],
    recoveryRate: "80-100% (for the lender); 20-50% (for guarantor via subrogation)",
    costRange: "0.5-2% guarantee fee",
    calculatorParams: [
      { id: "loanAmount", label: "Loan Amount Guaranteed", type: "currency", default: 10000000, min: 500000, max: 200000000, step: 500000 },
      { id: "coverage", label: "Guarantee Coverage (%)", type: "percentage", default: 50, min: 10, max: 100, step: 5 },
      { id: "fee", label: "Annual Guarantee Fee (%)", type: "percentage", default: 1.5, min: 0.25, max: 4, step: 0.25 },
      { id: "term", label: "Guarantee Term (years)", type: "years", default: 7, min: 1, max: 20, step: 1 },
    ],
    costFormula: "Annual cost to borrower = Loan Amount x Coverage x Fee. Total leverage = Loan Amount / (Guarantee Fee x Term).",
    features: ["high-leverage", "risk-mitigation", "concessionary"],
    useCase: "Emerging market lending, affordable housing, SME lending, infrastructure",
  },

  {
    id: "first-loss-guarantee",
    slug: "first-loss-guarantee",
    name: "First-Loss Guarantee",
    shortName: "First-Loss Guarantee",
    category: "guarantee",
    number: 10,
    tagline: "Absorbing the riskiest slice to crowd in capital",
    description:
      "A guarantee that covers the first X% of losses in a portfolio, making the remaining exposure palatable to commercial investors. A 5% first-loss guarantee on a $100M portfolio commits just $5M while unlocking the full $100M.",
    sources: [
      { name: "Philanthropic Foundations", type: "source", description: "Using guarantee capital for maximum leverage" },
      { name: "DFIs", type: "source", description: "Government-backed agencies providing portfolio backstops" },
      { name: "Government Backstops", type: "source", description: "Public programs de-risking private investment" },
    ],
    typicalSize: "$500K - $50M (covering 5-20% of portfolio)",
    motivationMix: { impact: 65, financial: 5, policy: 30 },
    financialReturn: { min: -100, expected: -5, max: 1 },
    nonFinancialReturns: ["Maximum leverage of any instrument", "Credit enhancement", "Market creation"],
    riskLevel: "high",
    actors: [
      { name: "Commercial Investors", type: "counterparty", description: "Pension funds, banks, insurance companies now protected from first losses" },
      { name: "Fund Manager", type: "enabler", description: "Manages the portfolio and allocates losses per the guarantee structure" },
      { name: "Rating Agency", type: "ecosystem", description: "May rate portfolio higher due to first-loss protection — potentially investment-grade" },
    ],
    defaultSteps: [
      { step: 1, title: "Portfolio Losses Emerge", description: "Individual loans or investments in the portfolio default" },
      { step: 2, title: "First-Loss Guarantee Absorbs", description: "All losses allocated to guarantor until guarantee cap is reached", lossAbsorber: "Guarantor (first-loss)" },
      { step: 3, title: "Guarantee Cap Reached", description: "If total losses exceed guarantee %, commercial investors bear remaining losses", lossAbsorber: "Commercial investors" },
    ],
    recoveryRate: "0-20% (for guarantor)",
    costRange: "Near-zero to borrowers",
    calculatorParams: [
      { id: "portfolio", label: "Total Portfolio Size", type: "currency", default: 100000000, min: 5000000, max: 1000000000, step: 5000000 },
      { id: "firstLossPct", label: "First-Loss Coverage (%)", type: "percentage", default: 10, min: 2, max: 25, step: 1 },
      { id: "expectedLoss", label: "Expected Portfolio Loss", type: "percentage", default: 5, min: 1, max: 20, step: 1 },
    ],
    costFormula: "Guarantee amount = Portfolio x First-Loss %. Leverage ratio = Portfolio / Guarantee. Expected loss to guarantor = min(Expected Portfolio Loss, First-Loss %) x Portfolio.",
    features: ["high-leverage", "risk-tolerant", "market-creating"],
    useCase: "Blended finance vehicles, emerging market funds, green bond enhancement",
  },

  {
    id: "performance-guarantee",
    slug: "performance-guarantee",
    name: "Performance Guarantee / Surety Bond",
    shortName: "Surety Bond",
    category: "guarantee",
    number: 11,
    tagline: "Guaranteeing delivery, not just payment",
    description:
      "A three-party agreement where a surety guarantees that a project developer will fulfill contractual obligations. If the developer fails to perform, the surety compensates the project owner or arranges completion.",
    sources: [
      { name: "Insurance Companies", type: "source", description: "Surety divisions of major insurers", examples: ["Liberty Mutual", "Travelers", "Zurich"] },
      { name: "Surety Companies", type: "source", description: "Specialized surety bond providers" },
      { name: "Government Backstop Facilities", type: "source", description: "Public programs guaranteeing performance for first-of-a-kind projects" },
    ],
    typicalSize: "$1M - $100M+ (bond value)",
    motivationMix: { impact: 10, financial: 80, policy: 10 },
    financialReturn: { min: -50, expected: 3, max: 5 },
    nonFinancialReturns: ["Risk pooling", "Market confidence building"],
    riskLevel: "moderate",
    actors: [
      { name: "Project Developer (Principal)", type: "counterparty", description: "The entity whose performance is being guaranteed" },
      { name: "Offtake Buyer / Project Owner", type: "counterparty", description: "The party protected if the developer fails to deliver" },
      { name: "Bonding Agent", type: "enabler", description: "Brokers the surety bond and manages the relationship" },
    ],
    defaultSteps: [
      { step: 1, title: "Developer Fails to Perform", description: "Project misses milestones, quality standards, or completion deadline" },
      { step: 2, title: "Offtake Buyer Files Claim", description: "Protected party submits claim to surety with evidence of non-performance" },
      { step: 3, title: "Surety Responds", description: "Surety either funds project completion, compensates buyer, or arranges alternative contractor", lossAbsorber: "Surety company" },
      { step: 4, title: "Subrogation", description: "Surety pursues recovery from the developer for losses paid" },
    ],
    recoveryRate: "50-80% (via subrogation from developer)",
    costRange: "1-5% of bond value",
    calculatorParams: [
      { id: "bondValue", label: "Bond Value", type: "currency", default: 20000000, min: 1000000, max: 200000000, step: 1000000 },
      { id: "premium", label: "Annual Premium (%)", type: "percentage", default: 2.5, min: 0.5, max: 5, step: 0.25 },
      { id: "term", label: "Bond Term (years)", type: "years", default: 3, min: 1, max: 10, step: 1 },
    ],
    costFormula: "Annual cost = Bond Value x Premium Rate. Total cost = Annual cost x Term.",
    features: ["risk-mitigation", "performance-linked", "commercial"],
    useCase: "Construction projects, FOAK manufacturing, infrastructure delivery",
  },

  {
    id: "political-risk-insurance",
    slug: "political-risk-insurance",
    name: "Political Risk Insurance",
    shortName: "PRI / MIGA",
    category: "guarantee",
    number: 12,
    tagline: "Protection against sovereign and political risk",
    description:
      "Insurance against political risks — expropriation, currency inconvertibility, political violence, breach of contract by governments. Enables investment in markets where political risk would otherwise be a dealbreaker.",
    sources: [
      { name: "Multilateral Agencies", type: "source", description: "International organizations providing sovereign risk coverage", examples: ["MIGA (World Bank)", "ATI"] },
      { name: "Export Credit Agencies", type: "source", description: "National agencies supporting overseas investment", examples: ["DFC (US)", "UK Export Finance"] },
      { name: "Specialty Insurers", type: "source", description: "Private political risk insurance markets", examples: ["Lloyd's syndicates", "AIG"] },
    ],
    typicalSize: "$5M - $500M+ (insured amount)",
    motivationMix: { impact: 30, financial: 40, policy: 30 },
    financialReturn: { min: -30, expected: 3, max: 5 },
    nonFinancialReturns: ["Development mandate fulfillment", "Market opening", "Diplomatic leverage"],
    riskLevel: "moderate",
    actors: [
      { name: "Foreign Investor", type: "counterparty", description: "The investor whose capital is protected from political events" },
      { name: "Host Country Government", type: "counterparty", description: "The sovereign whose actions (or inactions) could trigger the policy" },
      { name: "Project Developer", type: "counterparty", description: "The in-country entity operating the project" },
    ],
    defaultSteps: [
      { step: 1, title: "Political Event Occurs", description: "Expropriation, currency controls, political violence, or contract breach by government" },
      { step: 2, title: "Investor Files Claim", description: "Protected investor provides evidence of loss due to political event" },
      { step: 3, title: "Insurer Pays Claim", description: "Insurer compensates investor for losses up to policy limits", lossAbsorber: "Insurance provider" },
      { step: 4, title: "International Arbitration", description: "Insurer may pursue claim against host government through ICSID or other arbitration" },
    ],
    recoveryRate: "70-100% (for investor, via insurance)",
    costRange: "0.5-1.5% annual premium",
    calculatorParams: [
      { id: "insuredAmount", label: "Insured Amount", type: "currency", default: 50000000, min: 1000000, max: 500000000, step: 1000000 },
      { id: "premium", label: "Annual Premium (%)", type: "percentage", default: 1, min: 0.3, max: 3, step: 0.1 },
      { id: "term", label: "Coverage Period (years)", type: "years", default: 10, min: 1, max: 20, step: 1 },
    ],
    costFormula: "Annual cost = Insured Amount x Premium Rate. Total cost = Annual x Term.",
    features: ["risk-mitigation", "market-enabling", "policy-driven"],
    useCase: "Emerging market infrastructure, power generation, mining, agriculture",
  },

  // ============================================
  // CATEGORY D: EQUITY INSTRUMENTS
  // ============================================
  {
    id: "concessionary-equity",
    slug: "concessionary-equity",
    name: "Below-Market / Concessionary Equity",
    shortName: "Concessionary Equity",
    category: "equity",
    number: 13,
    tagline: "Accepting less so others can invest",
    description:
      "Equity investment where the investor accepts below-market returns, effectively subsidizing the risk-return profile for co-investors. The concession may take the form of capped upside, reduced preferred return, or last-out waterfall position.",
    sources: [
      { name: "Impact-First Investors", type: "source", description: "Investors prioritizing impact over returns" },
      { name: "Foundations (MRIs/PRIs)", type: "source", description: "Foundation endowments deployed for impact" },
      { name: "DFIs", type: "source", description: "Development agencies accepting below-market equity returns" },
    ],
    typicalSize: "$1M - $50M",
    motivationMix: { impact: 75, financial: 15, policy: 10 },
    financialReturn: { min: -100, expected: 5, max: 10 },
    nonFinancialReturns: ["De-risking for co-investors", "Portfolio diversification", "Impact outcomes"],
    riskLevel: "high",
    actors: [
      { name: "Co-Investors", type: "counterparty", description: "Market-rate investors receiving enhanced returns due to concession", examples: ["Pension funds", "Endowments"] },
      { name: "Fund Manager / GP", type: "enabler", description: "Structures the fund and manages the waterfall" },
      { name: "Impact Measurement Provider", type: "ecosystem", description: "Verifies impact outcomes that justify the concession" },
    ],
    defaultSteps: [
      { step: 1, title: "Portfolio Underperforms", description: "Fund or company value declines" },
      { step: 2, title: "Concessionary Equity Absorbs First", description: "Often subordinated to other equity holders — absorbs losses before market-rate investors", lossAbsorber: "Concessionary equity holder" },
      { step: 3, title: "Liquidation Waterfall", description: "In total liquidation, concessionary equity is last to receive distributions" },
    ],
    recoveryRate: "0-40%",
    costRange: "5-10% target return (vs. 15-25% market)",
    calculatorParams: [
      { id: "amount", label: "Investment Amount", type: "currency", default: 10000000, min: 500000, max: 100000000, step: 500000 },
      { id: "targetReturn", label: "Concessionary Target Return (%)", type: "percentage", default: 6, min: 0, max: 15, step: 1 },
      { id: "marketReturn", label: "Market Equity Return (%)", type: "percentage", default: 18, min: 10, max: 30, step: 1 },
      { id: "holdPeriod", label: "Hold Period (years)", type: "years", default: 8, min: 3, max: 15, step: 1 },
    ],
    costFormula: "Concession = (Market Return - Target Return) x Amount x Hold Period. This subsidy flows to co-investors or the enterprise.",
    features: ["concessionary", "patient", "risk-tolerant"],
    useCase: "Impact funds, emerging market PE, climate equity, social housing",
  },

  {
    id: "first-loss-equity",
    slug: "first-loss-equity",
    name: "First-Loss Equity",
    shortName: "First-Loss Equity",
    category: "equity",
    number: 14,
    tagline: "The junior tranche in a tiered fund",
    description:
      "Equity positioned at the bottom of a fund's capital structure, absorbing initial losses before any other equity class is affected. Typically comes with capped upside and full downside exposure. The fundamental building block of blended finance equity structures.",
    sources: [
      { name: "Catalytic Investors", type: "source", description: "Mission-driven investors willing to take first-loss position" },
      { name: "Anchor LPs", type: "source", description: "Early limited partners providing de-risking for later investors" },
      { name: "Foundation Endowments", type: "source", description: "Large foundations deploying endowment capital catalytically" },
    ],
    typicalSize: "$5M - $100M (10-25% of fund)",
    motivationMix: { impact: 70, financial: 15, policy: 15 },
    financialReturn: { min: -100, expected: 3, max: 8 },
    nonFinancialReturns: ["Massive capital mobilization", "Market proof of concept", "Governance influence"],
    riskLevel: "very-high",
    actors: [
      { name: "Senior Equity Holders", type: "counterparty", description: "Pension funds, insurance companies receiving enhanced risk-adjusted returns" },
      { name: "Fund GP", type: "enabler", description: "Designs the waterfall and manages portfolio" },
      { name: "Placement Agent", type: "enabler", description: "Raises capital from institutional investors for senior tranches" },
    ],
    defaultSteps: [
      { step: 1, title: "Fund Portfolio Loses Value", description: "Portfolio companies decline or fail" },
      { step: 2, title: "Junior Tranche Absorbs Losses", description: "First-loss equity is reduced dollar-for-dollar with portfolio losses", lossAbsorber: "First-loss equity holders" },
      { step: 3, title: "Mezzanine Tranche Hit", description: "After junior tranche depleted, mezzanine absorbs remaining losses", lossAbsorber: "Mezzanine investors" },
      { step: 4, title: "Senior Tranche Protected", description: "Senior equity only impacted after all subordinate tranches are wiped out", lossAbsorber: "Senior equity (last resort)" },
    ],
    recoveryRate: "0-20%",
    costRange: "3-8% capped return",
    calculatorParams: [
      { id: "fundSize", label: "Total Fund Size", type: "currency", default: 100000000, min: 10000000, max: 500000000, step: 10000000 },
      { id: "juniorPct", label: "Junior/First-Loss Tranche (%)", type: "percentage", default: 20, min: 5, max: 35, step: 1 },
      { id: "mezzPct", label: "Mezzanine Tranche (%)", type: "percentage", default: 30, min: 0, max: 40, step: 5 },
      { id: "expectedReturn", label: "Expected Fund Return (%)", type: "percentage", default: 12, min: -10, max: 30, step: 1 },
    ],
    costFormula: "Senior return = Fund return enhanced by junior loss absorption. Junior bears all losses up to tranche size before others are affected.",
    features: ["risk-tolerant", "concessionary", "high-leverage"],
    useCase: "Blended finance funds, emerging market equity, climate funds, FOAK portfolios",
  },

  {
    id: "patient-equity",
    slug: "patient-equity",
    name: "Patient / Long-Duration Equity",
    shortName: "Patient Equity",
    category: "equity",
    number: 15,
    tagline: "Capital that waits for impact to compound",
    description:
      "Equity with extended hold periods (10-20+ years) versus the typical 5-7 year PE/VC timeline. Allows businesses to prioritize long-term value creation over quick exits. Particularly suited for infrastructure, deep tech, and systems-change ventures.",
    sources: [
      { name: "Evergreen / Permanent Capital Vehicles", type: "source", description: "Funds with no fixed exit timeline" },
      { name: "Family Offices", type: "source", description: "Multigenerational wealth with long time horizons" },
      { name: "Foundations", type: "source", description: "Endowments with perpetual mandates" },
      { name: "Sovereign Wealth Funds", type: "source", description: "National funds with generational investment horizons" },
    ],
    typicalSize: "$5M - $200M",
    motivationMix: { impact: 50, financial: 40, policy: 10 },
    financialReturn: { min: -100, expected: 10, max: 20 },
    nonFinancialReturns: ["Intergenerational wealth", "Infrastructure value creation", "Systems change"],
    riskLevel: "moderate",
    actors: [
      { name: "Portfolio Company Management", type: "counterparty", description: "Freed from short-term exit pressure, can build for the long term" },
      { name: "Impact Verification Body", type: "ecosystem", description: "Long-term impact tracking and reporting" },
    ],
    defaultSteps: [
      { step: 1, title: "Business Underperforms Over Time", description: "Extended timeline means more runway, but eventually value must be created" },
      { step: 2, title: "Standard Equity Loss", description: "If company ultimately fails, equity investors lose their investment", lossAbsorber: "Patient equity holders" },
      { step: 3, title: "Extended Recovery Window", description: "Longer hold means more time for turnaround — reduces probability of total loss" },
    ],
    recoveryRate: "Varies widely — longer runway improves odds",
    costRange: "8-15% target IRR",
    calculatorParams: [
      { id: "amount", label: "Investment Amount", type: "currency", default: 15000000, min: 1000000, max: 100000000, step: 1000000 },
      { id: "targetIRR", label: "Target IRR (%)", type: "percentage", default: 10, min: 3, max: 20, step: 1 },
      { id: "holdPeriod", label: "Hold Period (years)", type: "years", default: 12, min: 5, max: 25, step: 1 },
    ],
    costFormula: "Target value at exit = Investment x (1 + IRR)^Hold Period. Longer hold = higher multiple needed but lower annual pressure.",
    features: ["patient", "flexible", "long-duration"],
    useCase: "Climate infrastructure, deep tech commercialization, affordable housing portfolios",
  },

  {
    id: "anchor-commitment",
    slug: "anchor-commitment",
    name: "Catalytic Anchor Commitment",
    shortName: "Anchor Commitment",
    category: "equity",
    number: 16,
    tagline: "The first check that validates the fund",
    description:
      "An early, significant commitment to a fund that signals credibility and de-risks fundraising for follow-on investors. The anchor's due diligence, reputation, and commitment creates a reference point that accelerates capital formation.",
    sources: [
      { name: "Lead / Anchor Investors", type: "source", description: "Major institutional investors willing to commit early", examples: ["Large foundations", "DFIs", "Sovereign wealth funds"] },
    ],
    typicalSize: "$10M - $100M+ (typically 15-30% of fund)",
    motivationMix: { impact: 50, financial: 35, policy: 15 },
    financialReturn: { min: -100, expected: 10, max: 20 },
    nonFinancialReturns: ["Governance rights", "Fund shaping influence", "First-mover insight", "Market creation"],
    riskLevel: "high",
    actors: [
      { name: "Follow-on LPs", type: "counterparty", description: "Later investors attracted by the anchor's validation", examples: ["Pension funds", "Insurance companies", "Endowments"] },
      { name: "Fund Manager / GP", type: "enabler", description: "Benefits from anchor's credibility and fundraising momentum" },
      { name: "Placement Agent", type: "enabler", description: "Leverages anchor commitment to attract additional investors" },
    ],
    defaultSteps: [
      { step: 1, title: "Fund Underperforms", description: "Portfolio returns below expectations" },
      { step: 2, title: "Anchor Bears Proportional Loss", description: "Same as other LPs unless anchor has special structural terms", lossAbsorber: "All LPs pro-rata" },
      { step: 3, title: "Reputational Impact", description: "Anchor's reputation may help or hinder future fundraising in the space" },
    ],
    recoveryRate: "Same as underlying fund equity",
    costRange: "Market-rate equity (8-18% target)",
    calculatorParams: [
      { id: "fundSize", label: "Target Fund Size", type: "currency", default: 200000000, min: 20000000, max: 1000000000, step: 10000000 },
      { id: "anchorPct", label: "Anchor Commitment (%)", type: "percentage", default: 25, min: 10, max: 50, step: 5 },
      { id: "targetReturn", label: "Fund Target Return (%)", type: "percentage", default: 12, min: 5, max: 25, step: 1 },
    ],
    costFormula: "Anchor amount = Fund Size x Anchor %. Anchor's financial cost same as other LPs. Catalytic value = enabling full fund raise.",
    features: ["market-creating", "signaling", "governance"],
    useCase: "New fund launches, emerging managers, first-time climate funds, new geographies",
  },

  // ============================================
  // CATEGORY E: STRUCTURED & HYBRID
  // ============================================
  {
    id: "tiered-fund",
    slug: "tiered-fund",
    name: "Tiered / Tranched Fund Structure",
    shortName: "Blended Fund",
    category: "hybrid",
    number: 17,
    tagline: "Different risk appetites, one fund",
    description:
      "A fund with multiple capital layers (tranches) offering different risk-return profiles. Junior tranches absorb first losses, protecting senior tranches. This allows impact-motivated investors and commercial investors to co-invest in the same portfolio at terms that suit each.",
    sources: [
      { name: "Junior Tranche: Catalytic Investors", type: "source", description: "Foundations, DFIs taking first-loss" },
      { name: "Mezzanine Tranche: Impact Investors", type: "source", description: "Impact funds seeking moderate risk/return" },
      { name: "Senior Tranche: Commercial Investors", type: "source", description: "Pension funds, insurance companies, banks seeking near-fixed-income exposure", examples: ["CalPERS", "Allianz", "JPMorgan"] },
    ],
    typicalSize: "$50M - $1B+",
    motivationMix: { impact: 45, financial: 40, policy: 15 },
    financialReturn: { min: -100, expected: 8, max: 15 },
    nonFinancialReturns: ["Capital mobilization", "Institutional market access", "Impact at scale"],
    riskLevel: "moderate",
    actors: [
      { name: "Fund Manager / GP", type: "enabler", description: "Designs structure, raises capital, manages investments" },
      { name: "Legal Structurer", type: "enabler", description: "Drafts waterfall, intercreditor agreements, fund documents" },
      { name: "Auditor", type: "ecosystem", description: "Verifies NAV calculations, waterfall distributions" },
      { name: "Impact Measurement Provider", type: "ecosystem", description: "Tracks and reports impact metrics across portfolio" },
    ],
    defaultSteps: [
      { step: 1, title: "Portfolio Losses Occur", description: "Individual investments in the fund lose value or default" },
      { step: 2, title: "Junior Tranche Absorbs First", description: "All losses allocated to junior/first-loss tranche until depleted", lossAbsorber: "Junior tranche investors" },
      { step: 3, title: "Mezzanine Takes Residual Losses", description: "After junior is wiped out, mezzanine tranche absorbs losses", lossAbsorber: "Mezzanine investors" },
      { step: 4, title: "Senior Tranche Protected", description: "Senior investors only impacted after all subordinated capital is depleted", lossAbsorber: "Senior investors (final)" },
    ],
    recoveryRate: "Junior: 0-20% | Mezz: 40-70% | Senior: 80-100%",
    costRange: "Blended: 6-10%",
    calculatorParams: [
      { id: "fundSize", label: "Total Fund Size", type: "currency", default: 200000000, min: 20000000, max: 1000000000, step: 10000000 },
      { id: "juniorPct", label: "Junior Tranche (%)", type: "percentage", default: 15, min: 5, max: 30, step: 1 },
      { id: "mezzPct", label: "Mezzanine Tranche (%)", type: "percentage", default: 25, min: 0, max: 40, step: 5 },
      { id: "portfolioReturn", label: "Portfolio Return (%)", type: "percentage", default: 10, min: -20, max: 30, step: 1 },
      { id: "portfolioLoss", label: "Portfolio Loss Rate (%)", type: "percentage", default: 8, min: 0, max: 50, step: 1 },
    ],
    costFormula: "Waterfall: Losses absorbed junior→mezz→senior. Returns distributed senior→mezz→junior. Blended cost = weighted average across tranches.",
    features: ["risk-tolerant", "concessionary", "high-leverage", "market-creating"],
    useCase: "Climate funds, emerging market debt/equity, affordable housing, SME portfolios",
  },

  {
    id: "technical-assistance",
    slug: "technical-assistance",
    name: "Technical Assistance Facility",
    shortName: "TA Facility",
    category: "hybrid",
    number: 18,
    tagline: "Grant-funded support alongside investment",
    description:
      "A grant-funded facility that provides capacity building, advisory services, and operational support to companies in an investment portfolio. Sits alongside (not inside) the investment vehicle, improving outcomes for all investors.",
    sources: [
      { name: "Foundation Grants", type: "source", description: "Philanthropic capital funding the TA facility" },
      { name: "DFI Grant Windows", type: "source", description: "Technical assistance grants from development agencies" },
      { name: "Government Programs", type: "source", description: "Public sector capacity-building funds" },
    ],
    typicalSize: "$1M - $20M (2-5% of paired fund)",
    motivationMix: { impact: 80, financial: 0, policy: 20 },
    financialReturn: { min: -100, expected: -100, max: -100 },
    nonFinancialReturns: ["Improved portfolio outcomes", "Stronger investee companies", "Knowledge building"],
    riskLevel: "very-low",
    actors: [
      { name: "TA Consultants / Providers", type: "enabler", description: "Deliver capacity building services to portfolio companies" },
      { name: "Investee Companies", type: "counterparty", description: "Portfolio companies receiving support" },
      { name: "Paired Investment Fund", type: "counterparty", description: "The fund whose portfolio companies benefit from TA" },
    ],
    defaultSteps: [
      { step: 1, title: "TA Activity Underdelivers", description: "Capacity building doesn't achieve intended effect" },
      { step: 2, title: "No Financial Default", description: "TA is grant-funded — no financial recovery expected or possible", lossAbsorber: "Grant funder (by design)" },
      { step: 3, title: "Program Adjustment", description: "TA provider refines approach based on learnings" },
    ],
    recoveryRate: "0%",
    costRange: "0% (grant-funded)",
    calculatorParams: [
      { id: "fundSize", label: "Paired Fund Size", type: "currency", default: 100000000, min: 10000000, max: 500000000, step: 10000000 },
      { id: "taPct", label: "TA Facility (% of fund)", type: "percentage", default: 3, min: 1, max: 10, step: 0.5 },
    ],
    costFormula: "TA Budget = Fund Size x TA %. Cost to investees = $0 (grant-funded). Indirect benefit: improved revenue/operations.",
    features: ["non-repayable", "capacity-building", "impact-focused"],
    useCase: "Emerging market SME funds, climate adaptation, financial inclusion",
  },

  {
    id: "pay-for-success",
    slug: "pay-for-success",
    name: "Pay-for-Success / Social Impact Bond",
    shortName: "Impact Bond",
    category: "hybrid",
    number: 19,
    tagline: "Government pays only if it works",
    description:
      "Investors fund a social or environmental intervention upfront. If predetermined outcomes are achieved (verified by an independent evaluator), the government or outcome payer repays investors with a return. If outcomes fail, investors lose their capital.",
    sources: [
      { name: "Impact Investors", type: "source", description: "Investors willing to accept outcome-contingent returns" },
      { name: "Philanthropic Funders", type: "source", description: "Foundations providing initial risk capital" },
    ],
    typicalSize: "$2M - $50M",
    motivationMix: { impact: 60, financial: 25, policy: 15 },
    financialReturn: { min: -100, expected: 7, max: 15 },
    nonFinancialReturns: ["Evidence-based impact", "Government savings", "Scalable model proof"],
    riskLevel: "high",
    actors: [
      { name: "Government / Outcome Payer", type: "counterparty", description: "Pays investors IF outcomes achieved — saves money vs. status quo" },
      { name: "Service Provider", type: "counterparty", description: "Delivers the intervention (therapy, job training, environmental restoration, etc.)" },
      { name: "Independent Evaluator", type: "enabler", description: "Verifies whether outcomes were achieved per agreed metrics" },
      { name: "Intermediary / Structurer", type: "enabler", description: "Designs the bond, negotiates terms, manages relationships" },
    ],
    defaultSteps: [
      { step: 1, title: "Intervention Delivered", description: "Service provider implements the program" },
      { step: 2, title: "Outcomes Evaluated", description: "Independent evaluator measures results against agreed benchmarks" },
      { step: 3, title: "Outcomes Not Achieved", description: "Government does not pay. Investors absorb the full loss.", lossAbsorber: "Impact investors / philanthropic funders" },
      { step: 4, title: "Alternatively: Outcomes Achieved", description: "Government pays investors principal + return from its savings" },
    ],
    recoveryRate: "0% (if outcomes fail) / 100%+ (if outcomes achieved)",
    costRange: "7-15% (outcome-contingent)",
    calculatorParams: [
      { id: "amount", label: "Investment Amount", type: "currency", default: 10000000, min: 1000000, max: 100000000, step: 1000000 },
      { id: "returnOnSuccess", label: "Return if Outcomes Met (%)", type: "percentage", default: 10, min: 3, max: 20, step: 1 },
      { id: "successProb", label: "Probability of Success (%)", type: "percentage", default: 65, min: 20, max: 90, step: 5 },
      { id: "term", label: "Program Duration (years)", type: "years", default: 5, min: 2, max: 10, step: 1 },
    ],
    costFormula: "Expected return = (Success Prob x Return) + ((1 - Success Prob) x -100%). Cost to government only if successful.",
    features: ["outcome-linked", "risk-tolerant", "evidence-based"],
    useCase: "Recidivism reduction, chronic homelessness, early childhood education, environmental restoration",
  },

  {
    id: "offtake-backed",
    slug: "offtake-backed-financing",
    name: "Offtake-Backed Financing",
    shortName: "Offtake Finance",
    category: "hybrid",
    number: 20,
    tagline: "Contracted revenue unlocks project capital",
    description:
      "Project financing secured by long-term purchase agreements (offtake contracts). A creditworthy buyer's commitment to purchase the project's output provides the revenue certainty lenders need to fund construction and operations.",
    sources: [
      { name: "Project Finance Lenders", type: "source", description: "Infrastructure and project finance debt providers", examples: ["Major banks", "Infrastructure funds"] },
      { name: "Development Banks", type: "source", description: "DFIs providing project-level debt", examples: ["IFC", "EBRD", "ADB"] },
    ],
    typicalSize: "$20M - $1B+",
    motivationMix: { impact: 25, financial: 60, policy: 15 },
    financialReturn: { min: -40, expected: 6, max: 9 },
    nonFinancialReturns: ["Infrastructure building", "Market creation for new products/fuels"],
    riskLevel: "moderate",
    actors: [
      { name: "Offtake Buyer", type: "counterparty", description: "Corporation, utility, or government with long-term purchase commitment. This is THE critical counterparty.", examples: ["Utilities (PPAs)", "Airlines (SAF)", "Steel companies (green H2)"] },
      { name: "Project Developer / SPV", type: "counterparty", description: "Special purpose vehicle that owns and operates the project" },
      { name: "EPC Contractor", type: "enabler", description: "Designs and builds the project" },
      { name: "Insurance Provider", type: "enabler", description: "Covers construction, operational, and political risks" },
    ],
    defaultSteps: [
      { step: 1, title: "Project Fails to Deliver", description: "Construction delays, technology failure, or production shortfall" },
      { step: 2, title: "Offtake Buyer Has No Obligation", description: "If project doesn't produce, buyer doesn't pay — contract performance is bilateral" },
      { step: 3, title: "Lender Claims Project Assets", description: "Project finance is non-recourse — lender can only claim the project itself, not the developer's other assets", lossAbsorber: "Project lenders" },
      { step: 4, title: "Alternative: Offtake Buyer Defaults", description: "If buyer doesn't honor contract, project loses revenue → potential cascade to debt default", lossAbsorber: "Project developer → then lenders" },
    ],
    recoveryRate: "40-70% (asset recovery from project)",
    costRange: "4-9% (depends on offtake credit quality)",
    calculatorParams: [
      { id: "projectCost", label: "Total Project Cost", type: "currency", default: 200000000, min: 10000000, max: 2000000000, step: 10000000 },
      { id: "debtPct", label: "Debt Percentage (%)", type: "percentage", default: 70, min: 40, max: 90, step: 5 },
      { id: "interestRate", label: "Debt Interest Rate (%)", type: "percentage", default: 6, min: 3, max: 12, step: 0.25 },
      { id: "contractLength", label: "Offtake Contract (years)", type: "years", default: 15, min: 5, max: 30, step: 1 },
    ],
    costFormula: "Debt service = (Project Cost x Debt %) x Rate. Lower offtake buyer credit risk → lower rate. Investment-grade buyer can reduce rate by 200-400 bps.",
    features: ["contract-backed", "project-finance", "scalable"],
    useCase: "Renewable energy (PPAs), sustainable aviation fuel, green hydrogen, carbon capture",
  },

  // ============================================
  // CATEGORY F: GOVERNMENT & POLICY
  // ============================================
  {
    id: "doe-lpo",
    slug: "doe-lpo",
    name: "DOE Loan Programs Office",
    shortName: "DOE LPO",
    category: "government",
    number: 21,
    tagline: "Federal loans for clean energy at scale",
    description:
      "The DOE Loan Programs Office is authorized to lend $400B+ across Title XVII (innovative clean energy), ATVM (advanced vehicle manufacturing), and Tribal Energy programs. Provides below-market, long-tenor loans for projects too risky or too large for purely commercial financing.",
    sources: [
      { name: "U.S. Federal Government (DOE)", type: "source", description: "U.S. Department of Energy lending programs, funded by taxpayers" },
    ],
    typicalSize: "$100M - $12B+",
    motivationMix: { impact: 30, financial: 10, policy: 60 },
    financialReturn: { min: -100, expected: 3, max: 5 },
    nonFinancialReturns: ["Clean energy deployment", "Domestic manufacturing", "Job creation", "Energy security"],
    riskLevel: "moderate",
    actors: [
      { name: "Private Co-Investors", type: "counterparty", description: "Equity investors, other lenders participating alongside DOE" },
      { name: "Project Developer", type: "counterparty", description: "Company building and operating the project" },
      { name: "Congressional Oversight", type: "ecosystem", description: "Legislative oversight of DOE lending authority" },
      { name: "OMB", type: "ecosystem", description: "Scores credit subsidy cost — key to program economics" },
    ],
    defaultSteps: [
      { step: 1, title: "Project Struggles", description: "Technology or market challenges prevent project from meeting financial targets" },
      { step: 2, title: "DOE Works with Borrower", description: "DOE typically restructures before declaring default — government has patience" },
      { step: 3, title: "If Default: First Lien", description: "DOE holds first lien on project assets — strong recovery position", lossAbsorber: "U.S. taxpayers (ultimately)" },
      { step: 4, title: "Portfolio Context", description: "Historical LPO portfolio has been net profitable despite notable individual losses" },
    ],
    recoveryRate: "60-90% (government first lien)",
    costRange: "2-4% (Treasury + spread)",
    calculatorParams: [
      { id: "loanAmount", label: "DOE Loan Amount", type: "currency", default: 500000000, min: 50000000, max: 5000000000, step: 50000000 },
      { id: "rate", label: "Interest Rate (Treasury + spread)", type: "percentage", default: 3.5, min: 2, max: 6, step: 0.25 },
      { id: "term", label: "Loan Term (years)", type: "years", default: 20, min: 5, max: 30, step: 1 },
      { id: "commercialRate", label: "Comparable Commercial Rate", type: "percentage", default: 9, min: 5, max: 15, step: 0.5 },
    ],
    costFormula: "Interest savings = (Commercial Rate - DOE Rate) x Loan Amount x Term. This subsidy makes marginal projects viable.",
    features: ["patient", "concessionary", "policy-driven", "large-scale"],
    useCase: "First-of-a-kind clean energy, EV manufacturing, nuclear, grid infrastructure",
  },

  {
    id: "ira-tax-credits",
    slug: "ira-tax-credits",
    name: "IRA Tax Credits",
    shortName: "Tax Credits",
    category: "government",
    number: 22,
    tagline: "Dollar-for-dollar incentives from the IRS",
    description:
      "The Inflation Reduction Act created and expanded tax credits (ITC, PTC, 45X, 45V, 45Q, etc.) that provide dollar-for-dollar reduction in tax liability for clean energy investments. Transferability provisions (new under IRA) allow credits to be sold for ~90-95 cents on the dollar.",
    sources: [
      { name: "Federal Government (foregone revenue)", type: "source", description: "IRS/Treasury — government absorbs cost through reduced tax collection" },
      { name: "Tax Equity Investors", type: "source", description: "Banks and corporations that monetize credits against their tax liability", examples: ["JPMorgan", "Bank of America", "Google"] },
    ],
    typicalSize: "Credits: $1M - $500M+ per project",
    motivationMix: { impact: 20, financial: 40, policy: 40 },
    financialReturn: { min: 0, expected: 7, max: 12 },
    nonFinancialReturns: ["Clean energy deployment", "Domestic manufacturing", "ESG compliance"],
    riskLevel: "low",
    actors: [
      { name: "Tax Equity Investor", type: "counterparty", description: "Entity with tax liability that invests to claim credits" },
      { name: "Project Developer", type: "counterparty", description: "Generates the credits through qualifying activities" },
      { name: "Tax Credit Broker", type: "enabler", description: "Intermediary matching credit sellers with buyers under transferability" },
      { name: "IRS / Treasury", type: "ecosystem", description: "Administers credit rules, qualification, and recapture provisions" },
    ],
    defaultSteps: [
      { step: 1, title: "Project Fails Qualification", description: "Project doesn't meet domestic content, prevailing wage, or other bonus requirements" },
      { step: 2, title: "Credit Recapture", description: "If project fails within recapture period, developer/tax equity must repay credits to IRS", lossAbsorber: "Developer or tax equity investor" },
      { step: 3, title: "Transferability Risk", description: "Under transfer, if seller's project is disqualified after transfer, buyer may lose credit value", lossAbsorber: "Credit buyer (under current rules)" },
    ],
    recoveryRate: "Varies — recapture is the primary risk",
    costRange: "5-9% (tax equity) / improving with transferability",
    calculatorParams: [
      { id: "projectCost", label: "Eligible Project Cost", type: "currency", default: 100000000, min: 5000000, max: 1000000000, step: 5000000 },
      { id: "creditPct", label: "Credit Rate (%)", type: "percentage", default: 30, min: 6, max: 50, step: 1 },
      { id: "transferPrice", label: "Transfer Price (cents/$)", type: "percentage", default: 92, min: 80, max: 99, step: 1 },
    ],
    costFormula: "Credit value = Project Cost x Credit Rate. If transferred: Cash received = Credit Value x Transfer Price. Effective cost of capital reduced by credit amount.",
    features: ["policy-driven", "scalable", "transferable"],
    useCase: "Solar/wind, battery storage, EV manufacturing, hydrogen, carbon capture, nuclear",
  },

  {
    id: "oced-grants",
    slug: "oced-grants",
    name: "OCED / Government Demo Grants",
    shortName: "Demo Grants",
    category: "government",
    number: 23,
    tagline: "Public funding for first-of-a-kind tech",
    description:
      "Grant funding from government agencies (DOE's Office of Clean Energy Demonstrations, ARPA-E, state programs) to de-risk demonstration-scale technology. Typically requires 50%+ cost-share from private sector, ensuring skin in the game while reducing FOAK risk.",
    sources: [
      { name: "DOE OCED", type: "source", description: "Office of Clean Energy Demonstrations — $20B+ in IRA/BIL funding", examples: ["Regional Clean Hydrogen Hubs", "Carbon Capture Demos"] },
      { name: "ARPA-E", type: "source", description: "High-risk, high-reward early-stage energy technology" },
      { name: "State Clean Energy Funds", type: "source", description: "State-level green banks and innovation funds", examples: ["NYSERDA", "CEC", "MassCEC"] },
    ],
    typicalSize: "$5M - $500M+",
    motivationMix: { impact: 30, financial: 0, policy: 70 },
    financialReturn: { min: -100, expected: -100, max: -100 },
    nonFinancialReturns: ["Technology de-risking", "Domestic manufacturing", "Knowledge/IP generation", "Job creation"],
    riskLevel: "very-low",
    actors: [
      { name: "Technology Developer", type: "counterparty", description: "Company or consortium building the demonstration project" },
      { name: "University / National Lab", type: "counterparty", description: "Research partners providing expertise" },
      { name: "Private Co-Investors", type: "counterparty", description: "Required cost-share partners (typically 50%+)" },
      { name: "Congressional Oversight", type: "ecosystem", description: "Political risk of program funding changes" },
    ],
    defaultSteps: [
      { step: 1, title: "Technology Doesn't Work at Scale", description: "Demo project fails to prove commercial viability" },
      { step: 2, title: "No Financial Recovery", description: "Grant funds are not recoverable. Public money is lost.", lossAbsorber: "Taxpayers / government" },
      { step: 3, title: "Knowledge Generated", description: "Even failed demos generate valuable data and IP for future attempts" },
      { step: 4, title: "Political Risk", description: "Program may face political opposition or funding cuts" },
    ],
    recoveryRate: "0%",
    costRange: "0% (requires cost-share)",
    calculatorParams: [
      { id: "totalProject", label: "Total Project Cost", type: "currency", default: 200000000, min: 10000000, max: 2000000000, step: 10000000 },
      { id: "grantPct", label: "Government Share (%)", type: "percentage", default: 50, min: 20, max: 80, step: 5 },
      { id: "privatePct", label: "Private Cost-Share (%)", type: "percentage", default: 50, min: 20, max: 80, step: 5 },
    ],
    costFormula: "Grant amount = Project Cost x Government Share. Private cost-share = Project Cost x Private %. Zero cost of capital on the grant portion.",
    features: ["non-repayable", "policy-driven", "demonstration-scale", "risk-reducing"],
    useCase: "Clean hydrogen hubs, direct air capture, advanced nuclear, long-duration storage",
  },
];

// Merge real-world examples into each instrument
export const instruments: Instrument[] = rawInstruments.map((inst) => ({
  ...inst,
  realWorldExamples: realWorldData[inst.slug] ?? inst.realWorldExamples,
}));
